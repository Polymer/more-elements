<!DOCTYPE html>
<!--
Copyright 2013 The Toolkitchen Authors. All rights reserved.
Use of this source code is governed by a BSD-style
license that can be found in the LICENSE file.
-->
<link rel="stylesheet" href="google-kratu-bc126c1/css/kratu.css">
<script src="google-kratu-bc126c1/js/kratu.js"></script>
<script src="google-kratu-bc126c1/js/dataproviders/csv.js"></script>
<script src="google-kratu-bc126c1/js/dataproviders/json.js"></script>
<element name="g-kratu">
  <script>
    Toolkit.register(this, {
      src: '',
      report: '',
      data: null,
      definition: null,
      ready: function() {
        // Instantiate a new Kratu object
        this.kratu = new Kratu();
        // Tell Kratu where to render our report
        this.kratu.setRenderElement(this);
      },
      srcChanged: function() {
        var csvProvider = new KratuCSVProvider();
        csvProvider.load(this.src, function(data) {
          this.data = data;
        }.bind(this));
      },
      reportChanged: function() {
        this.needsRender = false;
        var jsonProvider = new KratuJsonProvider();
        jsonProvider.load(this.report, 
          function (reportDefinition) {
            this.definition = reportDefinition;
          }.bind(this)
        );
      },
      definitionChanged: function() {
        this.kratu.setReportDefinition(this.definition);
        this.render();
      },
      dataChanged: function() {
        this.kratu.setEntities(this.data);
        this.render();
      },
      render: function() {
        if (!this.needsRender) {
          this.needsRender = true;
          setTimeout(function() {
            if (this.needsRender) {
              this.kratu.renderReport();
              this.needsRender = false;
            }
          }.bind(this), 10);
        }
      }
    });
  </script>
</element>
